<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - StudentEvents</title>
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="stylesheet" href="/admin/admin-dashboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="header-left">
                    <button class="back-btn-header" onclick="history.back()" aria-label="Go back">
                        <i class="fas fa-arrow-left"></i>
                        <span>Back</span>
                    </button>
                    <div class="logo">
                        <i class="fas fa-ticket-alt"></i>
                        <span>StudentEvents</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="admin-controls">
                        <div class="admin-badge">
                            <i class="fas fa-cog"></i>
                            <span>Admin Portal</span>
                        </div>
                        <button class="logout-btn" onclick="adminLogout()">
                            <i class="fas fa-sign-out-alt"></i>
                            <span class="logout-text">Logout</span>
                        </button>
                    </div>
                    <div class="header-actions">
                        <button class="mobile-menu-toggle" aria-label="Toggle menu" title="Toggle menu">
                            <i class="fas fa-bars"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
        <a href="/index.html" class="mobile-nav-link">Back to Events</a>
        <a href="/rules.html" class="mobile-nav-link">Rules & Policy</a>
        <a href="#contact" class="mobile-nav-link">Contact</a>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Dashboard Header -->
            <div class="dashboard-header">
                <h1 class="dashboard-title">
                    <i class="fas fa-tachometer-alt"></i>
                    Admin Dashboard
                </h1>
                <p class="dashboard-subtitle">Manage events, workers, and system settings</p>
            </div>

            <!-- Navigation Tabs -->
            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="events" onclick="adminDashboard.switchTab('events')">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Events</span>
                </button>
                <button class="tab-btn" data-tab="bookings" onclick="adminDashboard.switchTab('bookings')">
                    <i class="fas fa-receipt"></i>
                    <span>Bookings</span>
                </button>
                <button class="tab-btn" data-tab="workers" onclick="adminDashboard.switchTab('workers')">
                    <i class="fas fa-users"></i>
                    <span>Workers</span>
                </button>
                <button class="tab-btn" data-tab="settings" onclick="adminDashboard.switchTab('settings')">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Events Tab -->
                <div class="tab-panel active" id="eventsPanel">
                    <div class="panel-header">
                        <h2 class="panel-title">Event Management</h2>
                        <button class="btn btn-primary" onclick="adminDashboard.showCreateEventModal()">
                            <i class="fas fa-plus"></i>
                            Create Event
                        </button>
                    </div>

                    <!-- Events Statistics -->
                    <div class="stats-overview">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="totalEvents">0</div>
                                <div class="stat-label">Total Events</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-ticket-alt"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="totalTickets">0</div>
                                <div class="stat-label">Tickets Sold</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-euro-sign"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="totalRevenue">‚Ç¨0</div>
                                <div class="stat-label">Total Revenue</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="upcomingEvents">0</div>
                                <div class="stat-label">Upcoming</div>
                            </div>
                        </div>
                    </div>

                    <!-- Events Table -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3>All Events</h3>
                            <div class="table-actions">
                                <label class="filter-checkbox">
                                    <input type="checkbox" id="showCompletedEvents" onchange="adminDashboard.toggleCompletedEvents(this.checked)" checked>
                                    <span>Show Completed Events</span>
                                </label>
                                <button class="btn btn-secondary btn-sm" onclick="adminDashboard.exportEvents()">
                                    <i class="fas fa-download"></i>
                                    Export Events
                                </button>
                                <button class="btn btn-primary btn-sm" onclick="adminDashboard.exportParticipants()">
                                    <i class="fas fa-users"></i>
                                    Export Participants
                                </button>
                            </div>
                        </div>
                        <div class="table-wrapper">
                            <table class="data-table" id="eventsTable">
                                <thead>
                                    <tr>
                                        <th>Event Name</th>
                                        <th>Date</th>
                                        <th>Location</th>
                                        <th>Price</th>
                                        <th>Sold/Total</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="eventsTableBody">
                                    <!-- Content will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Bookings Tab -->
                <div class="tab-panel" id="bookingsPanel">
                    <div class="panel-header">
                        <h2 class="panel-title">Booking Management</h2>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-secondary" onclick="adminDashboard.exportBookingsToExcel()">
                                <i class="fas fa-file-excel"></i>
                                Export to Excel
                            </button>
                            <button class="btn btn-secondary" onclick="adminDashboard.refreshBookings()">
                                <i class="fas fa-sync-alt"></i>
                                Refresh
                            </button>
                        </div>
                    </div>

                    <!-- Bookings Statistics -->
                    <div class="stats-overview">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="pendingBookings">0</div>
                                <div class="stat-label">Pending Payment</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="paidBookings">0</div>
                                <div class="stat-label">Paid</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-euro-sign"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="pendingRevenue">‚Ç¨0</div>
                                <div class="stat-label">Pending Revenue</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-times-circle"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="expiredBookings">0</div>
                                <div class="stat-label">Expired/Cancelled</div>
                            </div>
                        </div>
                    </div>

                    <!-- Bookings Table -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3>All Bookings</h3>
                            <div class="table-actions" style="display: flex; gap: 10px;">
                                <select class="form-select" id="bookingEventFilter" onchange="adminDashboard.filterBookingsByEvent(this.value)">
                                    <option value="all">All Events</option>
                                </select>
                                <select class="form-select" id="bookingStatusFilter" onchange="adminDashboard.filterBookings(this.value)">
                                    <option value="all">All Statuses</option>
                                    <option value="pending">Pending</option>
                                    <option value="paid">Paid</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>
                        <div class="table-wrapper">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Reference</th>
                                        <th>Event</th>
                                        <th>Customer</th>
                                        <th>Contact</th>
                                        <th>Qty</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Deadline</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="bookingsTableBody">
                                    <tr>
                                        <td colspan="10" class="empty-state">
                                            <i class="fas fa-inbox"></i>
                                            <p>No bookings yet</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Workers Tab -->
                <div class="tab-panel" id="workersPanel">
                    <div class="panel-header">
                        <h2 class="panel-title">Worker Management</h2>
                        <button class="btn btn-primary" onclick="adminDashboard.showCreateWorkerModal()">
                            <i class="fas fa-user-plus"></i>
                            Add Worker
                        </button>
                    </div>

                    <!-- Workers Table -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3>All Workers</h3>
                            <div class="table-actions">
                                <button class="btn btn-secondary btn-sm" onclick="adminDashboard.exportWorkers()">
                                    <i class="fas fa-download"></i>
                                    Export
                                </button>
                            </div>
                        </div>
                        <div class="table-wrapper">
                            <table class="data-table" id="workersTable">
                                <thead>
                                    <tr>
                                        <th>Full Name</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Assigned Event</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="workersTableBody">
                                    <!-- Content will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="tab-panel" id="settingsPanel">
                    <div class="panel-header">
                        <h2 class="panel-title">System Settings</h2>
                    </div>

                    <div class="settings-grid">
                        <!-- Bank Transfer Settings -->
                        <div class="settings-section" style="grid-column: 1 / -1;">
                            <h3 class="settings-section-title">
                                <i class="fas fa-university"></i>
                                Bank Transfer Payment Settings
                            </h3>
                            <form class="settings-form" id="bankTransferForm" onsubmit="adminDashboard.saveBankSettings(event)">
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                    <div class="form-group">
                                        <label class="form-label" for="bankRecipientName">Bank Recipient Name *</label>
                                        <input type="text" class="form-input" id="bankRecipientName" required>
                                        <small style="color: #666;">Name that appears on bank transfers</small>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="bankIban">Bank IBAN *</label>
                                        <input type="text" class="form-input" id="bankIban" required placeholder="LT12 3456 7890 1234 5678">
                                        <small style="color: #666;">IBAN for receiving payments</small>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="supportEmail">Support Email *</label>
                                        <input type="email" class="form-input" id="supportEmail" required>
                                        <small style="color: #666;">Email for customer inquiries</small>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="supportPhone">Support Phone Number *</label>
                                        <input type="tel" class="form-input" id="supportPhone" required placeholder="+370 600 00000">
                                        <small style="color: #666;">Phone number for customer support</small>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="supportWorkingHours">Support Working Hours *</label>
                                        <input type="text" class="form-input" id="supportWorkingHours" required placeholder="Mon-Fri 9:00-17:00">
                                        <small style="color: #666;">When support is available</small>
                                    </div>
                                </div>
                                <div style="margin-top: 20px;">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i>
                                        Save Bank Settings
                                    </button>
                                    <button type="button" class="btn btn-secondary" onclick="adminDashboard.loadBankSettings()" style="margin-left: 10px;">
                                        <i class="fas fa-undo"></i>
                                        Reset
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Organization Settings -->
                        <div class="settings-section">
                            <h3 class="settings-section-title">
                                <i class="fas fa-building"></i>
                                Organization
                            </h3>
                            <form class="settings-form" id="organizationForm">
                                <div class="form-group">
                                    <label class="form-label" for="orgName">Organization Name</label>
                                    <input type="text" class="form-input" id="orgName" value="StudentEvents">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="orgEmail">Contact Email</label>
                                    <input type="email" class="form-input" id="orgEmail" value="info@studentevents.com">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="orgPhone">Contact Phone</label>
                                    <input type="tel" class="form-input" id="orgPhone" value="+1 (555) 123-4567">
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    Save Changes
                                </button>
                            </form>
                        </div>

                        <!-- System Settings -->
                        <div class="settings-section">
                            <h3 class="settings-section-title">
                                <i class="fas fa-server"></i>
                                System
                            </h3>
                            <form class="settings-form" id="systemForm">
                                <div class="form-group">
                                    <div class="form-checkbox">
                                        <input type="checkbox" id="emailNotifications" checked>
                                        <label for="emailNotifications">Email Notifications</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="form-checkbox">
                                        <input type="checkbox" id="smsNotifications">
                                        <label for="smsNotifications">SMS Notifications</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="form-checkbox">
                                        <input type="checkbox" id="autoBackup" checked>
                                        <label for="autoBackup">Automatic Backups</label>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    Save Changes
                                </button>
                            </form>
                        </div>

                        <!-- Data Management -->
                        <div class="settings-section">
                            <h3 class="settings-section-title">
                                <i class="fas fa-database"></i>
                                Data Management
                            </h3>
                            <div class="settings-form">
                                <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">
                                    Clear all locally stored data including events and workers. This action cannot be undone.
                                </p>
                                <button type="button" class="btn btn-danger" onclick="adminDashboard.resetDashboardData()" title="Clear all data">
                                    <i class="fas fa-trash-alt"></i>
                                    Reset Dashboard Data
                                </button>
                            </div>
                        </div>

                        <!-- Policy & Rules Editor -->
                        <div class="settings-section" style="grid-column: 1 / -1;">
                            <h3 class="settings-section-title">
                                <i class="fas fa-file-contract"></i>
                                Policy & Rules Content
                            </h3>
                            <form class="settings-form" id="policyForm">
                                <div class="form-group">
                                    <label class="form-label" for="termsOfService">Terms of Service</label>
                                    <textarea class="form-textarea" id="termsOfService" rows="4" placeholder="Enter terms of service content..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="privacyPolicy">Privacy Policy</label>
                                    <textarea class="form-textarea" id="privacyPolicy" rows="4" placeholder="Enter privacy policy content..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="eventGuidelines">Event Guidelines</label>
                                    <textarea class="form-textarea" id="eventGuidelines" rows="4" placeholder="Enter event guidelines content..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="ticketPolicy">Ticket Policy</label>
                                    <textarea class="form-textarea" id="ticketPolicy" rows="4" placeholder="Enter ticket policy content..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="refundPolicy">Refund Policy</label>
                                    <textarea class="form-textarea" id="refundPolicy" rows="4" placeholder="Enter refund policy content..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="codeOfConduct">Code of Conduct</label>
                                    <textarea class="form-textarea" id="codeOfConduct" rows="4" placeholder="Enter code of conduct content..."></textarea>
                                </div>
                                <div class="policy-version-info" style="margin: 15px 0; padding: 10px; background: #f0f0f0; border-radius: 8px;">
                                    <small>Current Version: <strong id="currentPolicyVersion">1.0</strong> | Last Updated: <strong id="policyLastUpdated">--</strong></small>
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    Update Policy & Rules
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="/rules.html" class="footer-link">Rules & Policy</a>
                    <a href="#contact" class="footer-link">Contact</a>
                </div>
                <div class="footer-info">
                    <p>&copy; 2024 StudentEvents. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Create Event Modal -->
    <div class="modal" id="createEventModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create New Event</h3>
                <button class="modal-close" onclick="adminDashboard.closeCreateEventModal()" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="modal-form" id="createEventForm">
                <div class="form-group">
                    <label class="form-label" for="createEventName">Event Name</label>
                    <input type="text" class="form-input" id="createEventName" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="createEventDate">Date & Time</label>
                    <input type="datetime-local" class="form-input" id="createEventDate" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="createEventLocation">Location</label>
                    <input type="text" class="form-input" id="createEventLocation" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="createEventDescription">Description</label>
                    <textarea class="form-textarea" id="createEventDescription" rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="createEventImage">Event Image URL</label>
                    <input type="url" class="form-input" id="createEventImage" placeholder="https://example.com/image.jpg">
                </div>
                <div class="form-group">
                    <label class="form-label" for="createEventPrice">Price (‚Ç¨)</label>
                    <input type="number" class="form-input" id="createEventPrice" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="createEventTotalTickets">Total Tickets</label>
                    <input type="number" class="form-input" id="createEventTotalTickets" min="1" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="createEventMinAge">Minimum Age</label>
                    <input type="number" class="form-input" id="createEventMinAge" min="0" max="99" placeholder="e.g., 18">
                    <small style="color: #666; font-size: 0.85rem;">Leave blank for all ages</small>
                </div>
                <div class="form-group">
                    <label class="form-label" for="createEventDressCode">Dress Code</label>
                    <input type="text" class="form-input" id="createEventDressCode" placeholder="e.g., Casual, Formal, Themed...">
                    <small style="color: #666; font-size: 0.85rem;">Leave blank for no specific dress code</small>
                </div>
                <div class="form-group">
                    <label class="form-label" for="createEventStatus">Status</label>
                    <select class="form-input" id="createEventStatus">
                        <option value="active">Active</option>
                        <option value="coming-soon">Coming Soon (Tickets Not Available)</option>
                        <option value="sold-out">Sold Out</option>
                        <option value="cancelled">Cancelled</option>
                        <option value="completed">Completed (Not Shown on Main Page)</option>
                        <option value="completed-shown">Completed (Shown on Main Page)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="createEventTicketsAvailableDate">Tickets Available Date (Optional)</label>
                    <input type="date" class="form-input" id="createEventTicketsAvailableDate">
                    <small style="color: #666; font-size: 0.85rem;">When tickets will become available for purchase</small>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="adminDashboard.closeCreateEventModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        Create Event
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Event Modal -->
    <div class="modal" id="editEventModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Event</h3>
                <button class="modal-close" onclick="adminDashboard.closeEditEventModal()" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="modal-form" id="editEventForm">
                <div class="form-group">
                    <label class="form-label" for="editEventName">Event Name</label>
                    <input type="text" class="form-input" id="editEventName" name="editEventName" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editEventDate">Date & Time</label>
                    <input type="datetime-local" class="form-input" id="editEventDate" name="editEventDate" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editEventLocation">Location</label>
                    <input type="text" class="form-input" id="editEventLocation" name="editEventLocation" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editEventDescription">Description</label>
                    <textarea class="form-textarea" id="editEventDescription" name="editEventDescription" rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editEventImage">Event Image URL</label>
                    <input type="url" class="form-input" id="editEventImage" name="editEventImage" placeholder="https://example.com/image.jpg">
                </div>
                <div class="form-group">
                    <label class="form-label" for="editEventPrice">Price (‚Ç¨)</label>
                    <input type="number" class="form-input" id="editEventPrice" name="editEventPrice" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editEventTotalTickets">Total Tickets</label>
                    <input type="number" class="form-input" id="editEventTotalTickets" name="editEventTotalTickets" min="1" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editEventMinAge">Minimum Age</label>
                    <input type="number" class="form-input" id="editEventMinAge" name="editEventMinAge" min="0" max="99" placeholder="e.g., 18">
                    <small style="color: #666; font-size: 0.85rem;">Leave blank for all ages</small>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editEventDressCode">Dress Code</label>
                    <input type="text" class="form-input" id="editEventDressCode" name="editEventDressCode" placeholder="e.g., Casual, Formal, Themed...">
                    <small style="color: #666; font-size: 0.85rem;">Leave blank for no specific dress code</small>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editEventStatus">Status</label>
                    <select class="form-input" id="editEventStatus" name="editEventStatus">
                        <option value="active">Active</option>
                        <option value="coming-soon">Coming Soon (Tickets Not Available)</option>
                        <option value="sold-out">Sold Out</option>
                        <option value="cancelled">Cancelled</option>
                        <option value="completed">Completed (Not Shown on Main Page)</option>
                        <option value="completed-shown">Completed (Shown on Main Page)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editEventTicketsAvailableDate">Tickets Available Date (Optional)</label>
                    <input type="date" class="form-input" id="editEventTicketsAvailableDate" name="editEventTicketsAvailableDate">
                    <small style="color: #666; font-size: 0.85rem;">When tickets will become available for purchase</small>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="adminDashboard.closeEditEventModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Event Modal -->
    <div class="modal" id="viewEventModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Event Details</h3>
                <button class="modal-close" onclick="adminDashboard.closeViewEventModal()" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="viewEventContent">
                <!-- Content will be populated by JavaScript -->
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="adminDashboard.closeViewEventModal()">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Create Worker Modal -->
    <div class="modal" id="createWorkerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Worker</h3>
                <button class="modal-close" onclick="adminDashboard.closeCreateWorkerModal()" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="modal-form" id="createWorkerForm">
                <div class="form-group">
                    <label class="form-label" for="createWorkerName">Full Name</label>
                    <input type="text" class="form-input" id="createWorkerName" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="createWorkerEmail">Email</label>
                    <input type="email" class="form-input" id="createWorkerEmail" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="createWorkerPassword">Password</label>
                    <input type="password" class="form-input" id="createWorkerPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label class="form-label" for="createWorkerRole">Role</label>
                    <select class="form-input" id="createWorkerRole">
                        <option value="worker">Worker</option>
                        <option value="supervisor">Supervisor</option>
                        <option value="manager">Manager</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="adminDashboard.closeCreateWorkerModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i>
                        Add Worker
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Worker Modal -->
    <div class="modal" id="viewWorkerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Worker Details</h3>
                <button class="modal-close" onclick="adminDashboard.closeViewWorkerModal()" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="viewWorkerContent">
                <!-- Content will be populated by JavaScript -->
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="adminDashboard.closeViewWorkerModal()">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Worker Modal -->
    <div class="modal" id="editWorkerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Worker</h3>
                <button class="modal-close" onclick="adminDashboard.closeEditWorkerModal()" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="modal-form" id="editWorkerForm">
                <div class="form-group">
                    <label class="form-label" for="editWorkerName">Full Name</label>
                    <input type="text" class="form-input" id="editWorkerName" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editWorkerEmail">Email</label>
                    <input type="email" class="form-input" id="editWorkerEmail" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editWorkerRole">Role</label>
                    <select class="form-input" id="editWorkerRole">
                        <option value="worker">Worker</option>
                        <option value="supervisor">Supervisor</option>
                        <option value="manager">Manager</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="editWorkerStatus">Status</label>
                    <select class="form-input" id="editWorkerStatus">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="adminDashboard.closeEditWorkerModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="/scripts/main.js"></script>
    <script src="/scripts/config.js"></script>
    <script src="/admin/admin-workers-api.js"></script>
    <script src="/admin/admin-dashboard.js"></script>
    <script src="/admin/admin-api-connector.js"></script>
    <script>
        // Proper authentication check with JWT token validation
        document.addEventListener('DOMContentLoaded', async () => {
            const isAuthenticated = await checkAuthentication();
            if (!isAuthenticated) {
                window.location.href = '/admin/login.html';
            } else {
                // Initialize admin dashboard ONLY if it doesn't exist yet
                if (!window.adminDashboard) {
                    console.log('üìã Creating new AdminDashboard instance...');
                    window.adminDashboard = new AdminDashboard();
                } else {
                    console.log('‚úÖ AdminDashboard already exists, reusing existing instance');
                }
            }
        });

        async function checkAuthentication() {
            try {
                // Check if JWT token exists
                const token = localStorage.getItem('adminToken');
                if (!token) {
                    console.log('‚ùå No JWT token found');
                    return false;
                }

                // Check token expiration
                try {
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    const now = Math.floor(Date.now() / 1000);

                    if (payload.exp < now) {
                        console.log('‚ùå JWT token expired');
                        clearAuthData();
                        return false;
                    }
                } catch (error) {
                    console.log('‚ùå Invalid JWT token format');
                    clearAuthData();
                    return false;
                }

                console.log('‚úÖ Authentication successful');
                return true;

            } catch (error) {
                console.error('‚ùå Authentication check failed:', error);
                clearAuthData();
                return false;
            }
        }

        function clearAuthData() {
            localStorage.removeItem('adminToken');
            localStorage.removeItem('adminUser');
            sessionStorage.removeItem('adminAccess');
        }

        function adminLogout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear all authentication data
                localStorage.removeItem('adminToken');
                localStorage.removeItem('adminUser');
                sessionStorage.removeItem('adminAccess');

                // Redirect to login page
                window.location.href = '/admin/login.html';
            }
        }
    </script>
</body>
</html>