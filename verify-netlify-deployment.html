<!DOCTYPE html>
<html>
<head>
    <title>Netlify Deployment Verification</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 3px; font-family: monospace; white-space: pre-wrap; }
        iframe { width: 100%; height: 600px; border: 1px solid #ddd; border-radius: 5px; }
        .status { padding: 10px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîç Netlify Deployment Verification</h1>
    
    <div class="test-section info">
        <h3>Deployment Status Check:</h3>
        <p>This page will verify if Netlify has deployed the latest admin login page changes.</p>
        <p><strong>Expected Changes:</strong></p>
        <ul>
            <li>‚úÖ "Email: admin@studentevents.com" (not "Username: admin")</li>
            <li>‚úÖ Empty form fields (no auto-fill)</li>
            <li>‚úÖ "üîÑ UPDATED: Now uses Railway API authentication" message</li>
            <li>‚úÖ "‚úÖ FIXED: No auto-fill, proper validation" message</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h3>Test Controls:</h3>
        <button onclick="checkDeployment()">Check Deployment</button>
        <button onclick="forceRefresh()">Force Refresh</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <div class="test-section">
        <h3>Deployment Status:</h3>
        <div id="status" class="status info">Click "Check Deployment" to verify</div>
    </div>
    
    <div class="test-section">
        <h3>Test Results:</h3>
        <div id="log" class="log"></div>
    </div>
    
    <div class="test-section">
        <h3>Current Login Page:</h3>
        <iframe id="loginFrame" src="about:blank"></iframe>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info';
            statusDiv.innerHTML = `<div class="${className}">${message}</div>`;
        }
        
        function checkDeployment() {
            log('üîç Checking Netlify deployment status...', 'info');
            updateStatus('Checking deployment...', 'info');
            
            const iframe = document.getElementById('loginFrame');
            const loginUrl = 'https://afterstate.events/admin/login.html';
            
            // Add cache-busting parameter
            const cacheBuster = '?v=' + Date.now();
            iframe.src = loginUrl + cacheBuster;
            
            iframe.onload = function() {
                log('‚úÖ Login page loaded', 'success');
                
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    
                    // Check for updated messages
                    const subtitle = iframeDoc.querySelector('.login-subtitle');
                    if (subtitle) {
                        const subtitleText = subtitle.textContent;
                        
                        if (subtitleText.includes('üîÑ UPDATED: Now uses Railway API authentication')) {
                            log('‚úÖ Found "UPDATED" message - PASSED', 'success');
                        } else {
                            log('‚ùå Missing "UPDATED" message - FAILED', 'error');
                        }
                        
                        if (subtitleText.includes('‚úÖ FIXED: No auto-fill, proper validation')) {
                            log('‚úÖ Found "FIXED" message - PASSED', 'success');
                        } else {
                            log('‚ùå Missing "FIXED" message - FAILED', 'error');
                        }
                    } else {
                        log('‚ùå Subtitle not found - FAILED', 'error');
                    }
                    
                    // Check demo credentials
                    const demoCredentials = iframeDoc.querySelector('.demo-credentials');
                    if (demoCredentials) {
                        const credentialsText = demoCredentials.textContent;
                        
                        if (credentialsText.includes('Email: admin@studentevents.com')) {
                            log('‚úÖ Found "Email: admin@studentevents.com" - PASSED', 'success');
                        } else {
                            log('‚ùå Missing updated email format - FAILED', 'error');
                        }
                        
                        if (credentialsText.includes('Username: admin')) {
                            log('‚ùå Still shows "Username: admin" - FAILED', 'error');
                        } else {
                            log('‚úÖ No old "Username" format - PASSED', 'success');
                        }
                    } else {
                        log('‚ùå Demo credentials not found - FAILED', 'error');
                    }
                    
                    // Check form inputs
                    const emailInput = iframeDoc.querySelector('input[type="email"]');
                    const passwordInput = iframeDoc.querySelector('input[type="password"]');
                    
                    if (emailInput && passwordInput) {
                        if (emailInput.value === '' && passwordInput.value === '') {
                            log('‚úÖ Form fields are empty (no auto-fill) - PASSED', 'success');
                        } else {
                            log('‚ùå Form fields are pre-filled - FAILED', 'error');
                        }
                        
                        if (emailInput.placeholder.includes('email address')) {
                            log('‚úÖ Email placeholder is correct - PASSED', 'success');
                        } else {
                            log('‚ùå Email placeholder is incorrect - FAILED', 'error');
                        }
                    } else {
                        log('‚ùå Form inputs not found - FAILED', 'error');
                    }
                    
                    // Overall assessment
                    const errorCount = document.querySelectorAll('.error').length;
                    const successCount = document.querySelectorAll('.success').length;
                    
                    if (errorCount === 0) {
                        updateStatus('üéâ DEPLOYMENT SUCCESSFUL! All changes are live.', 'success');
                        log('üéâ All tests passed! The new version is deployed.', 'success');
                    } else {
                        updateStatus(`‚ö†Ô∏è DEPLOYMENT INCOMPLETE: ${errorCount} issues found.`, 'warning');
                        log(`‚ö†Ô∏è ${errorCount} issues found. Netlify may still be deploying.`, 'warning');
                    }
                    
                } catch (error) {
                    log('‚ö†Ô∏è Cannot access iframe content (CORS) - This is normal', 'warning');
                    log('Please check the page manually by visiting the URL', 'info');
                    updateStatus('‚ö†Ô∏è Cannot verify automatically. Please check manually.', 'warning');
                }
            };
            
            iframe.onerror = function() {
                log('‚ùå Failed to load login page', 'error');
                updateStatus('‚ùå Failed to load page', 'error');
            };
        }
        
        function forceRefresh() {
            log('üîÑ Forcing page refresh...', 'info');
            const iframe = document.getElementById('loginFrame');
            const loginUrl = 'https://afterstate.events/admin/login.html';
            const cacheBuster = '?v=' + Date.now();
            iframe.src = loginUrl + cacheBuster;
        }
        
        // Auto-check on page load
        window.onload = function() {
            log('üîç Netlify Deployment Verification Page Loaded', 'info');
            log('Click "Check Deployment" to verify if changes are live', 'info');
        };
    </script>
</body>
</html>
